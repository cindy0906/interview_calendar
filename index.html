<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI코치 사용자 인터뷰 – 일정 선택</title>
  <style>
  :root {
    --bg:#f7f9fb; 
    --card:#ffffff; 
    --text:#0f172a; 
    --muted:#475569; 
    --brand:#0ea5e9; 
    --line:#e2e8f0; 
    --ok:#22c55e; 
    --warn:#ef4444;
  }

  * { box-sizing:border-box; }

  body {
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Apple Color Emoji,Segoe UI Emoji;
  }

  header {
    position:sticky;
    top:0;
    background:linear-gradient(180deg,#ffffff,rgba(255,255,255,.92));
    backdrop-filter:saturate(120%) blur(6px);
    border-bottom:1px solid var(--line);
    z-index:10;
  }

  /* 전체 레이아웃 폭 확장 */
  .wrap {
    max-width:1400px; /* 1080 → 1400으로 확장 */
    margin:0 auto;
    padding:24px;
  }

  /* 캘린더 5열(월~금) */
  .calendar { margin-top:16px; }

  .cal-grid {
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap:16px;
    width:100%;
  }

  /* 선택 가능/불가 카드 동일 폭 보장 */
  .cal-grid > .date-card {
    width:100%;
  }

  h1 { font-size:22px; margin:0 0 6px; }
  p { margin:0 0 10px; color:var(--muted); }

  .card {
    background:var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    padding:16px;
  }

  /* 상단 기본정보 섹션 – 가로 한 덩이 */
  .info-row {
    display:flex;
    gap:12px;
    align-items:flex-end;
    flex-wrap:wrap;
  }

  .field {
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width:180px;
    flex:1;
  }

  .field label {
    font-size:13px;
    color:var(--muted);
  }

  .field input,
  .field select {
    width:100%;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid var(--line);
    background:#E6F1F7;
    font-size:14px;
  }

  .weekday {
    font-weight:700;
    color:var(--muted);
    text-align:center;
    margin-bottom:8px;
  }

  .date-card {
    background:#fff;
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    min-height:180px;
  }

  .date-head {
    display:flex;
    align-items:center;
    justify-content:space-between;
  }

  .date-head h3 {
    font-size:15px;
    margin:0;
  }

  .badge {
    font-size:11px;
    color:#fff;
    background:var(--brand);
    padding:3px 8px;
    border-radius:999px;
  }

  .disabled {
    opacity:.55;
  }

  .disabled .badge {
    background:#cbd5e1;
  }

  .times {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:8px;
  }

  .time {
    display:flex;
    align-items:center;
    gap:8px;
    font-size:14px;
    border:1px solid var(--line);
    border-radius:12px;
    padding:8px 10px;
    background:#fafcff;
  }

  /* 제출 버튼 – 하단 고정 느낌 */
  .submit-wrap {
    max-width:1080px;
    margin:18px auto 28px;
    display:flex;
    justify-content:center;
  }

  .submit-btn {
    appearance:none;
    border:none;
    background:var(--brand);
    color:#fff;
    padding:14px 24px;
    border-radius:14px;
    cursor:pointer;
    font-weight:700;
    font-size:16px;
    box-shadow:0 6px 20px rgba(14,165,233,.25);
  }

  .submit-btn:disabled {
    opacity:.6;
    cursor:not-allowed;
  }

  .center {
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
  }

  .thanks {
    font-size:20px;
    font-weight:800;
    margin-top:80px;
  }

  /* --- 반응형: 태블릿(<=1024px)에서는 2열 --- */
  @media (max-width: 1024px) {
    .cal-grid {
      grid-template-columns: repeat(2, 1fr);
      gap:14px;
    }
    .times {
      grid-template-columns: 1fr;
    }
  }

  /* --- 반응형: 모바일(<=640px)에서는 1열 --- */
  @media (max-width: 640px) {
    .cal-grid {
      grid-template-columns: 1fr;
      gap:12px;
    }
    .date-card {
      min-height:auto;
    }
    .times {
      grid-template-columns: 1fr;
    }
  }
</style>

</head>
<body>
  <header>
    <div class="wrap">
      <h1>AI코치 사용자 인터뷰 – 일정 선택</h1>
      <p>인터뷰 진행 기간: <b>10/21(화) ~ 11/5(수)</b> · 평일만 선택 가능</p>
    </div>
  </header>

  <main class="wrap" id="app">
    <!-- 상단: 기본 정보 (가로 한 덩이) -->
    <section class="card" aria-labelledby="infoTitle">
      <h2 id="infoTitle" style="margin:0 0 12px">기본 정보</h2>
      <div class="info-row">
        <div class="field" style="max-width:220px">
          <label for="consent">참여 의사</label>
          <select id="consent">
            <option value="">선택해주세요</option>
            <option value="yes">네, 참여하고 싶습니다</option>
            <option value="no">아니요, 이번에는 어렵습니다</option>
          </select>
        </div>
        <div class="field">
          <label for="name">이름</label>
          <input type="text" id="name" placeholder="홍길동" />
        </div>
        <div class="field">
          <label for="phone">연락처 (휴대폰)</label>
          <input type="tel" id="phone" placeholder="010-1234-5678" />
        </div>
      </div>
    </section>

    <!-- 하단: 캘린더 5열 -->
    <section class="card calendar" aria-labelledby="calTitle">
      <h2 id="calTitle" style="margin:0 0 12px">가능한 날짜/시간을 모두 체크해주세요</h2>
      <div class="cal-grid" id="calGrid"></div>
    </section>

    <div class="submit-wrap">
      <button id="submit" class="submit-btn">제출하기</button>
    </div>
  </main>

<script>
// ===== 설정 =====
const WEEKDAYS = ["일","월","화","수","목","금","토"];
// 5열 월~금 레이아웃. 기간은 2025년 기준 (필요시 변경)
const RANGE = { start: "2025-10-20", end: "2025-11-07" }; // 월~금로 딱 떨어지는 구간
// 아래 날짜는 카드에 "선택불가"만 표시 (체크 UI 없음)
const EXCLUDE_MMDD = new Set(["10-20","10-24","10-31","11-06","11-07"]);

const WEEKEND_BLOCK = true; // 토/일 선택 불가
// 시간 슬롯 (원하시면 여기서 변경 가능)
const TIME_SLOTS = [[9,10],[10,11],[11,12],[13,14],[14,15],[15,16],[16,17]];
const INCLUDE_ANYTIME = true; // "시간 상관 없음" 제공 여부

// ===== 유틸 =====
const fmt2 = n => n.toString().padStart(2,"0");
const toYMD = d => `${d.getFullYear()}-${fmt2(d.getMonth()+1)}-${fmt2(d.getDate())}`;
const mmdd = d => `${fmt2(d.getMonth()+1)}-${fmt2(d.getDate())}`;

function dateList(){
  const start = new Date(RANGE.start+"T00:00:00");
  const end = new Date(RANGE.end+"T00:00:00");
  const out = [];
  for(let d = new Date(start); d <= end; d.setDate(d.getDate()+1)){
    out.push(new Date(d));
  }
  return out;
}

// 주 단위(월~금)로 묶기
function weeksMonToFri(){
  const days = dateList();
  const weeks = [];
  let row = [];
  days.forEach(d => {
    const wd = d.getDay();
    if(wd === 1 && row.length){ // 새 주 시작
      weeks.push(row); row = [];
    }
    row.push(new Date(d));
  });
  if(row.length) weeks.push(row);

  // 각 주를 월~금 5칸으로 보정
  return weeks.map(week => {
    // 앞/뒤 보정 (기간이 월~금로 맞춰져 있어 보정 최소)
    const map = new Array(5).fill(null);
    week.forEach(d => {
      const idx = d.getDay() - 1; // 월=0 ... 금=4
      if(0 <= idx && idx <= 4) map[idx] = d;
    });
    return map; // 길이 5
  });
}

// 선택 데이터
const selected = {}; // { 'YYYY-MM-DD': Set(["09:00-10:00", ...]) }

function renderCalendar(){
  const grid = document.getElementById('calGrid');
  grid.innerHTML = '';

  weeksMonToFri().forEach(week => {
    week.forEach(d => {
      const card = document.createElement('div');
      card.className = 'date-card';

      if(!d){
        // 범위 밖 빈칸
        card.classList.add('disabled');
        card.innerHTML = `<div class="date-head"><h3>&nbsp;</h3><span class="badge">선택불가</span></div>`;
        grid.appendChild(card);
        return;
      }

      const isWeekend = (d.getDay()===0 || d.getDay()===6);
      const isExcluded = EXCLUDE_MMDD.has(mmdd(d));
      const ymd = toYMD(d);
      const title = `${fmt2(d.getMonth()+1)}/${fmt2(d.getDate())}(${WEEKDAYS[d.getDay()]})`;

      const head = document.createElement('div');
      head.className = 'date-head';
      head.innerHTML = `<h3>${title}</h3><span class="badge">${(WEEKEND_BLOCK && isWeekend) || isExcluded ? '선택불가':'선택'}</span>`;
      card.appendChild(head);

      const blocked = (WEEKEND_BLOCK && isWeekend) || isExcluded;
      if(blocked){
        card.classList.add('disabled');
        const blank = document.createElement('div');
        blank.style.minHeight = '100px';
        blank.className = 'center';
        blank.textContent = '선택불가';
        card.appendChild(blank);
        grid.appendChild(card);
        return;
      }

      const times = document.createElement('div');
      times.className = 'times';

      TIME_SLOTS.forEach(([h1,h2]) => {
        const label = `${fmt2(h1)}:00-${fmt2(h2)}:00`;
        const id = `${ymd}_${label}`;
        const wrap = document.createElement('label');
        wrap.className = 'time';
        wrap.innerHTML = `<input type="checkbox" data-ymd="${ymd}" value="${label}" id="${id}"><span>${label}</span>`;
        times.appendChild(wrap);
      });

      if(INCLUDE_ANYTIME){
        const any = document.createElement('label');
        any.className = 'time';
        any.innerHTML = `<input type="checkbox" data-ymd="${ymd}" value="시간 상관 없음" id="${ymd}_any"><span>시간 상관 없음</span>`;
        times.appendChild(any);
      }

      card.appendChild(times);
      grid.appendChild(card);
    });
  });

  grid.addEventListener('change', (e)=>{
    const t = e.target;
    if(t && t.matches('input[type="checkbox"][data-ymd]')){
      const day = t.getAttribute('data-ymd');
      const val = t.value;
      selected[day] ??= new Set();
      if(t.checked){
        if(val === '시간 상관 없음'){
          selected[day] = new Set(['시간 상관 없음']);
          document.querySelectorAll(`input[data-ymd="${day}"]`).forEach(inp=>{
            inp.checked = (inp.value === '시간 상관 없음');
          });
        }else{
          selected[day].add(val);
          const any = document.getElementById(`${day}_any`);
          if(any){ any.checked = false; selected[day].delete('시간 상관 없음'); }
        }
      }else{
        selected[day].delete(val);
      }
      if(selected[day] && selected[day].size===0) delete selected[day];
    }
  });
}

function payload(){
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const consent = document.getElementById('consent').value;
  const items = Object.keys(selected).sort().map(day=>({ date: day, slots: Array.from(selected[day]).sort() }));
  return { consent, name, phone, selections: items };
}

function validate(){
  const consentEl = document.getElementById('consent');
  const nameEl    = document.getElementById('name');
  const phoneEl   = document.getElementById('phone');

  const consent = (consentEl?.value || '').trim();   // "yes" | "no"
  const name    = (nameEl?.value || '').trim();
  const phone   = (phoneEl?.value || '').trim();
  const p       = payload(); // { consent, name, phone, selections: [...] }

  // 1️⃣ 참여의사/이름/연락처는 항상 필수
  if(!consent){
    alert('참여 의사를 선택해주세요.');
    return false;
  }
  if(!name || !phone){
    alert('이름과 연락처를 입력해주세요.');
    return false;
  }

  // 2️⃣ 참여의사가 "네"인 경우에만 시간 선택 1개 이상 필수
  if(consent === 'yes' && (!p.selections || p.selections.length === 0)){
    alert('가능한 날짜/시간을 최소 1개 이상 선택해주세요.');
    return false;
  }

  // 3️⃣ 참여의사가 "아니요"면 시간 선택 없어도 통과
  return true;
}


function showThanks(){
  // 본문을 간단한 감사 문구로 교체
  const app = document.getElementById('app');
  app.innerHTML = `<div class='wrap center thanks'>감사합니다! 인터뷰 시간은 조정 후 개별 연락드리겠습니다!</div>`;
}

renderCalendar();
// 🧩 Apps Script 웹앱 URL과 SECRET 토큰 넣기
const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbyaZNYZoYECVdShkKqhNmcrjW6gAuiDjcckNDkSDrhlIE7l5sxkmgoEYkOPGvp05VndTw/exec';
const SECRET = 'aicoach_interview_minipoc_10'; // Apps Script 코드의 SECRET과 동일

document.getElementById('submit').addEventListener('click', async ()=>{
  if(!validate()) return;

  const data = payload();
  data.secret = SECRET; // 비공개 토큰(본문에도 포함)

  try {
    const res = await fetch(WEBHOOK_URL + '?token=' + encodeURIComponent(SECRET), {
      method: 'POST',
      // CORS 사전요청 막기: 커스텀 헤더 제거, Content-Type을 text/plain으로
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(data)
    });

    // 실패 원인 디버깅을 위해 상세 메시지 표시
    const text = await res.text();
    let ok = false;
    try { ok = (JSON.parse(text).ok === true); } catch(_) {}
    if (res.ok && ok) {
      showThanks();
    } else {
      alert('제출 실패: ' + text);
    }
  } catch (e) {
    alert('네트워크 오류: ' + (e?.message || e));
  }
});


</script>
</body>
</html>
