<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AIì½”ì¹˜ ì‚¬ìš©ì ì¸í„°ë·° â€“ ì¼ì • ì„ íƒ</title>
  <style>
  :root {
    --bg:#f7f9fb; 
    --card:#ffffff; 
    --text:#0f172a; 
    --muted:#475569; 
    --brand:#0ea5e9; 
    --line:#e2e8f0; 
    --ok:#22c55e; 
    --warn:#ef4444;
  }

  * { box-sizing:border-box; }

  body {
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Apple Color Emoji,Segoe UI Emoji;
  }

  header {
    position:sticky;
    top:0;
    background:linear-gradient(180deg,#ffffff,rgba(255,255,255,.92));
    backdrop-filter:saturate(120%) blur(6px);
    border-bottom:1px solid var(--line);
    z-index:10;
  }

  /* ì „ì²´ ë ˆì´ì•„ì›ƒ í­ í™•ì¥ */
  .wrap {
    max-width:1600px; /* 1080 â†’ 1400ìœ¼ë¡œ í™•ì¥ */
    margin:0 auto;
    padding:24px;
  }

  /* ìº˜ë¦°ë” */
  .calendar { margin-top:16px; }

  /* >>> flex ê¸°ë°˜ ìº˜ë¦°ë” ë ˆì´ì•„ì›ƒ (ìµœëŒ€ 5ì¹´ë“œ/í–‰) <<< */
  .cal-grid{
    --cal-gap:16px;                /* ì¹´ë“œ ê°„ê²© ë³€ìˆ˜ */
    display:flex;
    flex-wrap:wrap;
    gap:var(--cal-gap);
    width:100%;
  }
  /* í•œ í–‰ ìµœëŒ€ 5ê°œ: (100% - 4*gap) / 5 */
  .cal-grid .date-card{
    flex:1 1 calc((100% - (4 * var(--cal-gap))) / 5);
    max-width:calc((100% - (4 * var(--cal-gap))) / 5);
  }

  h1 { font-size:22px; margin:0 0 6px; }
  p { margin:0 0 10px; color:var(--muted); }

  .card {
    background:var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    padding:16px;
  }

  /* ìƒë‹¨ ê¸°ë³¸ì •ë³´ ì„¹ì…˜ â€“ ê°€ë¡œ í•œ ë©ì´ */
  .info-row {
    display:flex;
    gap:12px;
    align-items:flex-end;
    flex-wrap:wrap;
  }

  .field {
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width:180px;
    flex:1;
  }

  .field label {
    font-size:13px;
    color:var(--muted);
  }

  .field input,
  .field select {
    width:100%;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid var(--line);
    background:#E6F1F7;
    font-size:14px;
  }

  .weekday {
    font-weight:700;
    color:var(--muted);
    text-align:center;
    margin-bottom:8px;
  }

  .date-card {
    background:#fff;
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    min-height:180px;
  }

  .date-head {
    display:flex;
    align-items:center;
    justify-content:space-between;
  }

  .date-head h3 {
    font-size:15px;
    margin:0;
  }

  .badge {
    font-size:11px;
    color:#fff;
    background:var(--brand);
    padding:3px 8px;
    border-radius:999px;
  }

  .disabled {
    opacity:.55;
  }

  .disabled .badge {
    background:#cbd5e1;
  }

  .times {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:8px;
  }

  .time {
    display:flex;
    align-items:center;
    gap:8px;
    font-size:14px;
    border:1px solid var(--line);
    border-radius:12px;
    padding:8px 10px;
    background:#fafcff;
  }

  /* ì œì¶œ ë²„íŠ¼ â€“ í•˜ë‹¨ ê³ ì • ëŠë‚Œ */
  .submit-wrap {
    max-width:1080px;
    margin:18px auto 28px;
    display:flex;
    justify-content:center;
  }

  .submit-btn {
    appearance:none;
    border:none;
    background:var(--brand);
    color:#fff;
    padding:14px 24px;
    border-radius:14px;
    cursor:pointer;
    font-weight:700;
    font-size:16px;
    box-shadow:0 6px 20px rgba(14,165,233,.25);
  }

  .submit-btn:disabled {
    opacity:.6;
    cursor:not-allowed;
  }

  .center {
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
  }

  .thanks {
    font-size:20px;
    font-weight:800;
    margin-top:80px;
  }

  /* --- ë°˜ì‘í˜•: íƒœë¸”ë¦¿(<=1024px)ì—ì„œëŠ” 2ì—´ --- */
  @media (max-width: 1024px) {
    /* (100% - 1*gap) / 2 */
    .cal-grid .date-card{
      flex:1 1 calc((100% - var(--cal-gap)) / 2);
      max-width:calc((100% - var(--cal-gap)) / 2);
    }
    .times { grid-template-columns: 1fr; }
  }

  /* --- ë°˜ì‘í˜•: ëª¨ë°”ì¼(<=640px)ì—ì„œëŠ” 1ì—´ --- */
  @media (max-width: 640px) {
    .cal-grid .date-card{
      flex:1 1 100%;
      max-width:100%;
    }
    .date-card { min-height:auto; }
    .times { grid-template-columns: 1fr; }
  }
</style>


</head>
<body>
  <header>
    <div class="wrap">
      <h1>AIì½”ì¹˜ ì‚¬ìš©ì ì¸í„°ë·° â€“ ì¼ì • ì„ íƒ</h1>
      <p>ì¸í„°ë·° ì§„í–‰ ê¸°ê°„: <b>11/17(ì›”) ~ 11/3(ìˆ˜)</b> Â· í‰ì¼ë§Œ ì„ íƒ ê°€ëŠ¥</p>
    </div>
  </header>

  <main class="wrap" id="app">
    <!-- ìƒë‹¨: ê¸°ë³¸ ì •ë³´ (ê°€ë¡œ í•œ ë©ì´) -->
    <section class="card" aria-labelledby="infoTitle">
      <h2 id="infoTitle" style="margin:0 0 12px">ê¸°ë³¸ ì •ë³´</h2>
      <div class="info-row">
        <div class="field" style="max-width:220px">
          <label for="consent">ì°¸ì—¬ ì˜ì‚¬</label>
          <select id="consent">
            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
            <option value="yes">ë„¤, ì°¸ì—¬í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤</option>
            <option value="no">ì•„ë‹ˆìš”, ì´ë²ˆì—ëŠ” ì–´ë µìŠµë‹ˆë‹¤</option>
          </select>
        </div>
        <div class="field">
          <label for="name">ì´ë¦„</label>
          <input type="text" id="name" placeholder="í™ê¸¸ë™" />
        </div>
        <div class="field">
          <label for="phone">ì—°ë½ì²˜ (íœ´ëŒ€í°)</label>
          <input type="tel" id="phone" placeholder="010-1234-5678" />
        </div>
      </div>
    </section>

    <!-- í•˜ë‹¨: ìº˜ë¦°ë” 5ì—´ -->
    <section class="card calendar" aria-labelledby="calTitle">
      <h2 id="calTitle" style="margin:0 0 12px">ê°€ëŠ¥í•œ ë‚ ì§œ/ì‹œê°„ì„ ëª¨ë‘ ì²´í¬í•´ì£¼ì„¸ìš”</h2>
      <div class="cal-grid" id="calGrid"></div>
    </section>

    <div class="submit-wrap">
      <button id="submit" class="submit-btn">ì œì¶œí•˜ê¸°</button>
    </div>
  </main>

<script>
// ===== ì„¤ì • =====
const WEEKDAYS = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
// 5ì—´ ì›”~ê¸ˆ ë ˆì´ì•„ì›ƒ. ê¸°ê°„ì€ 2025ë…„ ê¸°ì¤€ (í•„ìš”ì‹œ ë³€ê²½)
const RANGE = { start: "2025-11-17", end: "2025-12-05" }; // ì›”~ê¸ˆë¡œ ë”± ë–¨ì–´ì§€ëŠ” êµ¬ê°„
// ì•„ë˜ ë‚ ì§œëŠ” ì¹´ë“œì— "ì„ íƒë¶ˆê°€"ë§Œ í‘œì‹œ (ì²´í¬ UI ì—†ìŒ)
const EXCLUDE_MMDD = new Set(["11-18","11-26","12-04","12-05"]);

const WEEKEND_BLOCK = true; // í† /ì¼ ì„ íƒ ë¶ˆê°€
// ì‹œê°„ ìŠ¬ë¡¯ (ì›í•˜ì‹œë©´ ì—¬ê¸°ì„œ ë³€ê²½ ê°€ëŠ¥)
const TIME_SLOTS = [[9,10],[10,11],[11,12],[13,14],[14,15],[15,16],[16,17]];
const INCLUDE_ANYTIME = true; // "ì‹œê°„ ìƒê´€ ì—†ìŒ" ì œê³µ ì—¬ë¶€

// ===== ìœ í‹¸ =====
const fmt2 = n => n.toString().padStart(2,"0");
const toYMD = d => `${d.getFullYear()}-${fmt2(d.getMonth()+1)}-${fmt2(d.getDate())}`;
const mmdd = d => `${fmt2(d.getMonth()+1)}-${fmt2(d.getDate())}`;

function dateList(){
  const start = new Date(RANGE.start+"T00:00:00");
  const end = new Date(RANGE.end+"T00:00:00");
  const out = [];
  for(let d = new Date(start); d <= end; d.setDate(d.getDate()+1)){
    out.push(new Date(d));
  }
  return out;
}

// ì£¼ ë‹¨ìœ„(ì›”~ê¸ˆ)ë¡œ ë¬¶ê¸°
function weeksMonToFri(){
  const days = dateList();
  const weeks = [];
  let row = [];
  days.forEach(d => {
    const wd = d.getDay();
    if(wd === 1 && row.length){ // ìƒˆ ì£¼ ì‹œì‘
      weeks.push(row); row = [];
    }
    row.push(new Date(d));
  });
  if(row.length) weeks.push(row);

  // ê° ì£¼ë¥¼ ì›”~ê¸ˆ 5ì¹¸ìœ¼ë¡œ ë³´ì •
  return weeks.map(week => {
    // ì•/ë’¤ ë³´ì • (ê¸°ê°„ì´ ì›”~ê¸ˆë¡œ ë§ì¶°ì ¸ ìˆì–´ ë³´ì • ìµœì†Œ)
    const map = new Array(5).fill(null);
    week.forEach(d => {
      const idx = d.getDay() - 1; // ì›”=0 ... ê¸ˆ=4
      if(0 <= idx && idx <= 4) map[idx] = d;
    });
    return map; // ê¸¸ì´ 5
  });
}

// ì„ íƒ ë°ì´í„°
const selected = {}; // { 'YYYY-MM-DD': Set(["09:00-10:00", ...]) }

function renderCalendar(){
  const grid = document.getElementById('calGrid');
  grid.innerHTML = '';

  weeksMonToFri().forEach(week => {
    week.forEach(d => {
      const card = document.createElement('div');
      card.className = 'date-card';

      if(!d){
        // ë²”ìœ„ ë°– ë¹ˆì¹¸
        card.classList.add('disabled');
        card.innerHTML = `<div class="date-head"><h3>&nbsp;</h3><span class="badge">ì„ íƒë¶ˆê°€</span></div>`;
        grid.appendChild(card);
        return;
      }

      const isWeekend = (d.getDay()===0 || d.getDay()===6);
      const isExcluded = EXCLUDE_MMDD.has(mmdd(d));
      const ymd = toYMD(d);
      const title = `${fmt2(d.getMonth()+1)}/${fmt2(d.getDate())}(${WEEKDAYS[d.getDay()]})`;

      const head = document.createElement('div');
      head.className = 'date-head';
      head.innerHTML = `<h3>${title}</h3><span class="badge">${(WEEKEND_BLOCK && isWeekend) || isExcluded ? 'ì„ íƒë¶ˆê°€':'ì„ íƒ'}</span>`;
      card.appendChild(head);

      const blocked = (WEEKEND_BLOCK && isWeekend) || isExcluded;
      if(blocked){
        card.classList.add('disabled');
        const blank = document.createElement('div');
        blank.style.minHeight = '100px';
        blank.className = 'center';
        blank.textContent = 'ì„ íƒë¶ˆê°€';
        card.appendChild(blank);
        grid.appendChild(card);
        return;
      }

      const times = document.createElement('div');
      times.className = 'times';

      TIME_SLOTS.forEach(([h1,h2]) => {
        const label = `${fmt2(h1)}:00-${fmt2(h2)}:00`;
        const id = `${ymd}_${label}`;
        const wrap = document.createElement('label');
        wrap.className = 'time';
        wrap.innerHTML = `<input type="checkbox" data-ymd="${ymd}" value="${label}" id="${id}"><span>${label}</span>`;
        times.appendChild(wrap);
      });

      if(INCLUDE_ANYTIME){
        const any = document.createElement('label');
        any.className = 'time';
        any.innerHTML = `<input type="checkbox" data-ymd="${ymd}" value="ì‹œê°„ ìƒê´€ ì—†ìŒ" id="${ymd}_any"><span>ì‹œê°„ ìƒê´€ ì—†ìŒ</span>`;
        times.appendChild(any);
      }

      card.appendChild(times);
      grid.appendChild(card);
    });
  });

  grid.addEventListener('change', (e)=>{
    const t = e.target;
    if(t && t.matches('input[type="checkbox"][data-ymd]')){
      const day = t.getAttribute('data-ymd');
      const val = t.value;
      selected[day] ??= new Set();
      if(t.checked){
        if(val === 'ì‹œê°„ ìƒê´€ ì—†ìŒ'){
          selected[day] = new Set(['ì‹œê°„ ìƒê´€ ì—†ìŒ']);
          document.querySelectorAll(`input[data-ymd="${day}"]`).forEach(inp=>{
            inp.checked = (inp.value === 'ì‹œê°„ ìƒê´€ ì—†ìŒ');
          });
        }else{
          selected[day].add(val);
          const any = document.getElementById(`${day}_any`);
          if(any){ any.checked = false; selected[day].delete('ì‹œê°„ ìƒê´€ ì—†ìŒ'); }
        }
      }else{
        selected[day].delete(val);
      }
      if(selected[day] && selected[day].size===0) delete selected[day];
    }
  });
}

function payload(){
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const consent = document.getElementById('consent').value;
  const items = Object.keys(selected).sort().map(day=>({ date: day, slots: Array.from(selected[day]).sort() }));
  return { consent, name, phone, selections: items };
}

function validate(){
  const consentEl = document.getElementById('consent');
  const nameEl    = document.getElementById('name');
  const phoneEl   = document.getElementById('phone');

  const consent = (consentEl?.value || '').trim();   // "yes" | "no"
  const name    = (nameEl?.value || '').trim();
  const phone   = (phoneEl?.value || '').trim();
  const p       = payload(); // { consent, name, phone, selections: [...] }

  // 1ï¸âƒ£ ì°¸ì—¬ì˜ì‚¬/ì´ë¦„/ì—°ë½ì²˜ëŠ” í•­ìƒ í•„ìˆ˜
  if(!consent){
    alert('ì°¸ì—¬ ì˜ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return false;
  }
  if(!name || !phone){
    alert('ì´ë¦„ê³¼ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return false;
  }

  // 2ï¸âƒ£ ì°¸ì—¬ì˜ì‚¬ê°€ "ë„¤"ì¸ ê²½ìš°ì—ë§Œ ì‹œê°„ ì„ íƒ 1ê°œ ì´ìƒ í•„ìˆ˜
  if(consent === 'yes' && (!p.selections || p.selections.length === 0)){
    alert('ê°€ëŠ¥í•œ ë‚ ì§œ/ì‹œê°„ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return false;
  }

  // 3ï¸âƒ£ ì°¸ì—¬ì˜ì‚¬ê°€ "ì•„ë‹ˆìš”"ë©´ ì‹œê°„ ì„ íƒ ì—†ì–´ë„ í†µê³¼
  return true;
}


function showThanks(){
  // ë³¸ë¬¸ì„ ê°„ë‹¨í•œ ê°ì‚¬ ë¬¸êµ¬ë¡œ êµì²´
  const app = document.getElementById('app');
  app.innerHTML = `<div class='wrap center thanks'>ê°ì‚¬í•©ë‹ˆë‹¤! ì¸í„°ë·° ì‹œê°„ì€ ì¡°ì • í›„ ê°œë³„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤!</div>`;
}

renderCalendar();
// ğŸ§© Apps Script ì›¹ì•± URLê³¼ SECRET í† í° ë„£ê¸°
const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbyaZNYZoYECVdShkKqhNmcrjW6gAuiDjcckNDkSDrhlIE7l5sxkmgoEYkOPGvp05VndTw/exec';
const SECRET = 'aicoach_interview_minipoc_10'; // Apps Script ì½”ë“œì˜ SECRETê³¼ ë™ì¼

document.getElementById('submit').addEventListener('click', async ()=>{
  if(!validate()) return;

  const data = payload();
  data.secret = SECRET; // ë¹„ê³µê°œ í† í°(ë³¸ë¬¸ì—ë„ í¬í•¨)

  try {
    const res = await fetch(WEBHOOK_URL + '?token=' + encodeURIComponent(SECRET), {
      method: 'POST',
      // CORS ì‚¬ì „ìš”ì²­ ë§‰ê¸°: ì»¤ìŠ¤í…€ í—¤ë” ì œê±°, Content-Typeì„ text/plainìœ¼ë¡œ
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(data)
    });

    // ì‹¤íŒ¨ ì›ì¸ ë””ë²„ê¹…ì„ ìœ„í•´ ìƒì„¸ ë©”ì‹œì§€ í‘œì‹œ
    const text = await res.text();
    let ok = false;
    try { ok = (JSON.parse(text).ok === true); } catch(_) {}
    if (res.ok && ok) {
      showThanks();
    } else {
      alert('ì œì¶œ ì‹¤íŒ¨: ' + text);
    }
  } catch (e) {
    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + (e?.message || e));
  }
});


</script>
</body>
</html>
